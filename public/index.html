<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Prayer Beam OS</title>

    <link rel="icon" type="image/png" href="icon.png" />
    <link rel="apple-touch-icon" href="icon.png" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap"
      rel="stylesheet"
    />

    <style>
      /* --- 1. DESIGN SYSTEM (CSS VARIABLES) --- */
      :root {
        --primary: #d32f2f;
        --primary-rgb: 211, 47, 47;
        --bg-body: #ffffff;
        --bg-surface: #f4f6f8;
        --bg-glass: rgba(255, 255, 255, 0.9);
        --text-main: #1a1a1a;
        --text-sec: #666666;
        --border: #e5e5e5;
        --nav-height: 60px;
        --safe-top: env(safe-area-inset-top, 20px);
        --safe-bottom: env(safe-area-inset-bottom, 20px);
        --anim-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      [data-theme="dark"] {
        --bg-body: #000000;
        --bg-surface: #1c1c1e;
        --bg-glass: rgba(20, 20, 20, 0.9);
        --text-main: #f5f5f5;
        --text-sec: #a0a0a0;
        --border: #333333;
      }

      [data-theme="sepia"] {
        --bg-body: #f8f4e9;
        --bg-surface: #efe6d5;
        --bg-glass: rgba(248, 244, 233, 0.95);
        --text-main: #5b4636;
        --text-sec: #8c7b6e;
        --border: #dcd3c5;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        outline: none;
        user-select: none;
      }
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: var(--bg-body);
        color: var(--text-main);
        overflow: hidden;
        height: 100vh;
        width: 100vw;
      }

      /* --- 2. LAYOUT ENGINE --- */
      #app {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
      }

      .screen {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding-bottom: calc(
          var(--nav-height) + var(--safe-bottom) + 80px
        ); /* +80px for MiniPlayer */
        display: none;
        opacity: 0;
        transform: translateY(10px);
        transition: 0.3s ease;
      }
      .screen.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }

      /* Headers */
      .header {
        padding: calc(var(--safe-top) + 15px) 20px 15px 20px;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .header-title {
        font-size: 22px;
        font-weight: 800;
        letter-spacing: -0.5px;
      }

      /* --- 3. COMPONENT: TAB BAR --- */
      .tab-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: calc(var(--nav-height) + var(--safe-bottom));
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid var(--border);
        display: flex;
        align-items: flex-start;
        justify-content: space-around;
        padding-top: 8px;
        z-index: 1000;
      }
      .tab-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 60px;
        background: none;
        border: none;
        color: var(--text-sec);
        transition: 0.2s;
        cursor: pointer;
      }
      .tab-btn svg {
        width: 24px;
        height: 24px;
        fill: currentColor;
        margin-bottom: 4px;
      }
      .tab-btn span {
        font-size: 10px;
        font-weight: 600;
      }
      .tab-btn.active {
        color: var(--primary);
        transform: translateY(-2px);
      }

      /* --- 4. COMPONENT: MINI PLAYER (Pro Feature) --- */
      #mini-player {
        position: fixed;
        bottom: calc(var(--nav-height) + var(--safe-bottom) + 10px);
        left: 15px;
        right: 15px;
        height: 60px;
        background: var(--bg-surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        padding: 0 15px;
        gap: 12px;
        z-index: 900;
        transform: translateY(150%);
        transition: transform 0.4s var(--anim-spring);
      }
      #mini-player.visible {
        transform: translateY(0);
      }

      .mp-art {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 18px;
      }
      .mp-info {
        flex: 1;
        overflow: hidden;
      }
      .mp-title {
        font-size: 14px;
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .mp-sub {
        font-size: 11px;
        color: var(--text-sec);
      }
      .mp-controls button {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--text-main);
        cursor: pointer;
        padding: 0 5px;
      }

      /* --- 5. COMPONENT: BOTTOM SHEET (Settings) --- */
      .sheet-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 2000;
        opacity: 0;
        pointer-events: none;
        transition: 0.3s;
      }
      .sheet-overlay.active {
        opacity: 1;
        pointer-events: auto;
      }

      .sheet {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--bg-body);
        border-radius: 24px 24px 0 0;
        padding: 25px;
        transform: translateY(100%);
        transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      .sheet-overlay.active .sheet {
        transform: translateY(0);
      }
      .sheet-handle {
        width: 40px;
        height: 5px;
        background: var(--border);
        border-radius: 10px;
        margin: 0 auto 20px auto;
      }

      /* --- 6. UTILITIES & SKELETONS --- */
      .skeleton {
        background: linear-gradient(
          90deg,
          var(--bg-surface) 25%,
          var(--border) 50%,
          var(--bg-surface) 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 6px;
      }
      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }
      .option-box {
        padding: 12px;
        border-radius: 12px;
        border: 2px solid var(--border);
        text-align: center;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
      }
      .option-box.active {
        border-color: var(--primary);
        background: rgba(var(--primary-rgb), 0.05);
        color: var(--primary);
      }

      /* --- 7. BIBLE READER STYLES --- */
      .verse {
        font-family: "Crimson Pro", serif;
        font-size: 20px;
        line-height: 1.8;
        margin-bottom: 15px;
        padding: 4px;
        border-radius: 4px;
        transition: 0.2s;
      }
      .verse.active {
        background: rgba(var(--primary-rgb), 0.1);
      }
      .v-num {
        font-family: "Inter", sans-serif;
        font-size: 11px;
        font-weight: 700;
        color: var(--primary);
        vertical-align: super;
        margin-right: 4px;
      }
    </style>
  </head>
  <body data-theme="light">
    <div id="app">
      <div id="screen-home" class="screen active">
        <div class="header">
          <div class="header-title">Prayer Beam</div>
          <div
            style="font-size: 12px; font-weight: 600; color: var(--text-sec)"
          >
            WED, JAN 28
          </div>
        </div>
        <div style="padding: 20px">
          <div
            style="
              background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
              padding: 25px;
              border-radius: 20px;
              color: #111;
              box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
              margin-bottom: 25px;
            "
          >
            <div
              style="
                font-family: 'Crimson Pro';
                font-size: 22px;
                font-weight: 600;
                margin-bottom: 10px;
              "
            >
              "The Lord is my shepherd; I shall not want."
            </div>
            <div style="font-size: 13px; font-weight: 700; opacity: 0.7">
              PSALM 23:1
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div
              onclick="Router.go('songs')"
              style="
                background: var(--bg-surface);
                padding: 20px;
                border-radius: 16px;
                text-align: center;
              "
            >
              <div style="font-size: 28px">ðŸŽµ</div>
              <div style="font-weight: 700; margin-top: 10px">Lyrics</div>
            </div>
            <div
              onclick="Router.go('tv')"
              style="
                background: var(--bg-surface);
                padding: 20px;
                border-radius: 16px;
                text-align: center;
              "
            >
              <div style="font-size: 28px">ðŸ“º</div>
              <div style="font-weight: 700; margin-top: 10px">TV</div>
            </div>
          </div>
        </div>
      </div>

      <div id="screen-bible" class="screen">
        <div class="header">
          <div
            id="book-trigger"
            onclick="Sheet.open('book')"
            style="
              background: var(--bg-surface);
              padding: 8px 16px;
              border-radius: 20px;
              font-weight: 700;
              font-size: 15px;
              cursor: pointer;
            "
          >
            Genesis 1 â–¼
          </div>
          <div style="display: flex; gap: 10px">
            <button
              onclick="Player.playChapter()"
              style="
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
              "
            >
              ðŸ”Š
            </button>
            <button
              onclick="Sheet.open('settings')"
              style="
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
              "
            >
              Aa
            </button>
          </div>
        </div>
        <div
          id="bible-content"
          style="padding: 20px; max-width: 700px; margin: 0 auto"
        >
          <div
            class="skeleton"
            style="height: 20px; width: 90%; margin-bottom: 15px"
          ></div>
          <div
            class="skeleton"
            style="height: 20px; width: 95%; margin-bottom: 15px"
          ></div>
          <div
            class="skeleton"
            style="height: 20px; width: 80%; margin-bottom: 15px"
          ></div>
        </div>
      </div>

      <div id="screen-songs" class="screen">
        <div class="header"><div class="header-title">Worship</div></div>
        <div style="padding: 20px">
          <input
            type="text"
            placeholder="Search songs..."
            onkeyup="Songs.filter(this.value)"
            style="
              width: 100%;
              padding: 15px;
              background: var(--bg-surface);
              border: 1px solid var(--border);
              border-radius: 12px;
              font-size: 16px;
              margin-bottom: 20px;
            "
          />
          <div id="songs-list"></div>
        </div>
      </div>

      <div id="screen-tv" class="screen">
        <div class="header"><div class="header-title">Prayer Beam TV</div></div>
        <div style="padding: 20px">
          <div
            style="
              position: relative;
              padding-bottom: 56.25%;
              height: 0;
              border-radius: 16px;
              overflow: hidden;
              background: #000;
            "
          >
            <iframe
              style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
              "
              src="https://www.youtube.com/embed/videoseries?list=PLpcEZmijMVLBVJlP4oPCukvrRo-5wB-0i"
              frameborder="0"
              allowfullscreen
            ></iframe>
          </div>
          <h3 style="margin-top: 20px">Latest Messages</h3>
          <p style="color: var(--text-sec)">
            Watch our latest sermons and worship sessions directly from YouTube.
          </p>
        </div>
      </div>
    </div>

    <div id="mini-player">
      <div class="mp-art">ðŸŽµ</div>
      <div class="mp-info">
        <div class="mp-title" id="mp-title">Not Playing</div>
        <div class="mp-sub" id="mp-sub">Tap a song or chapter</div>
      </div>
      <div class="mp-controls">
        <button id="mp-btn" onclick="Player.toggle()">â–¶</button>
      </div>
    </div>

    <div id="sheet-overlay" class="sheet-overlay" onclick="Sheet.close()">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="sheet-handle"></div>
        <div id="sheet-content"></div>
      </div>
    </div>

    <nav class="tab-bar">
      <button class="tab-btn active" onclick="Router.go('home')">
        <svg viewBox="0 0 24 24">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /></svg
        ><span>Home</span>
      </button>
      <button class="tab-btn" onclick="Router.go('bible')">
        <svg viewBox="0 0 24 24">
          <path
            d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"
          /></svg
        ><span>Bible</span>
      </button>
      <button class="tab-btn" onclick="Router.go('songs')">
        <svg viewBox="0 0 24 24">
          <path
            d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
          /></svg
        ><span>Songs</span>
      </button>
      <button class="tab-btn" onclick="Router.go('tv')">
        <svg viewBox="0 0 24 24">
          <path
            d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 14H3V5h18v12zM8 15l8-5-8-5v10z"
          /></svg
        ><span>TV</span>
      </button>
    </nav>

    <script>
      // --- 1. STATE STORE (The Brain) ---
      const Store = {
        data: JSON.parse(localStorage.getItem("pb_os_v1")) || {
          theme: "light",
          lang: "te",
          bIdx: 0,
          cNum: 1,
          fontSize: 20,
        },
        save() {
          localStorage.setItem("pb_os_v1", JSON.stringify(this.data));
        },
        update(key, val) {
          this.data[key] = val;
          this.save();
        },
      };

      // --- 2. DATA CONSTANTS ---
      const BOOKS = [
        "Genesis",
        "Exodus",
        "Leviticus",
        "Numbers",
        "Deuteronomy",
        "Joshua",
        "Judges",
        "Ruth",
      ];
      const BOOKS_TE = [
        "à°†à°¦à°¿à°•à°¾à°‚à°¡à°®à±",
        "à°¨à°¿à°°à±à°—à°®à°•à°¾à°‚à°¡à°®à±",
        "à°²à±‡à°µà±€à°¯à°•à°¾à°‚à°¡à°®à±",
        "à°¸à°‚à°–à±à°¯à°¾à°•à°¾à°‚à°¡à°®à±",
        "à°¦à±à°µà°¿à°¤à±€à°¯à±‹à°ªà°¦à±‡à°¶à°•à°¾à°‚à°¡à°®à±",
        "à°¯à±†à°¹à±‹à°·à±à°µ",
        "à°¨à±à°¯à°¾à°¯à°¾à°§à°¿à°ªà°¤à±à°²à±",
        "à°°à±‚à°¤à±",
      ];
      const SONGS = [
        { t: "Yesayya Naa Pranama", l: "à°¯à±‡à°¸à°¯à±à°¯à°¾ à°¨à°¾ à°ªà±à°°à°¾à°£à°®à°¾..." },
        { t: "Neeve Hrudaya Saradhi", l: "à°¨à±€à°µà±‡ à°¹à±ƒà°¦à°¯ à°¸à°¾à°°à°§à°¿..." },
        { t: "Hosanna", l: "à°¹à±‹à°¸à°¨à±à°¨à°¾.. à°¹à±‹à°¸à°¨à±à°¨à°¾.." },
        { t: "Aaradhana", l: "à°†à°°à°¾à°§à°¨.. à°†à°°à°¾à°§à°¨.." },
      ];

      // --- 3. ROUTER (Navigation) ---
      const Router = {
        current: "home",
        go(screen) {
          document
            .querySelectorAll(".screen")
            .forEach((el) => el.classList.remove("active"));
          document.getElementById("screen-" + screen).classList.add("active");

          // Update Tab Bar
          document.querySelectorAll(".tab-btn").forEach((btn, i) => {
            btn.classList.toggle(
              "active",
              ["home", "bible", "songs", "tv"][i] === screen
            );
          });

          this.current = screen;
          if (screen === "bible") Bible.load();
          if (screen === "songs") Songs.render();
        },
      };

      // --- 4. BIBLE ENGINE ---
      const Bible = {
        async load() {
          const el = document.getElementById("bible-content");
          // Simulate Loading (Skeleton stays for 500ms)
          if (el.innerHTML.includes("skeleton"))
            await new Promise((r) => setTimeout(r, 400));

          // Update Button
          const bName =
            Store.data.lang === "te"
              ? BOOKS_TE[Store.data.bIdx]
              : BOOKS[Store.data.bIdx];
          document.getElementById(
            "book-trigger"
          ).innerText = `${bName} ${Store.data.cNum} â–¼`;

          // Fetch Data (Git API)
          try {
            const engName = BOOKS[Store.data.bIdx];
            const res = await fetch(
              `https://cdn.jsdelivr.net/gh/aruljohn/Bible-telugu@master/${engName}.json`
            );
            const json = await res.json();
            const verses = json.chapters[Store.data.cNum - 1].verses;

            el.innerHTML = verses
              .map(
                (v, i) =>
                  `<div class="verse" onclick="Bible.handleVerseClick(this)">
                            <span class="v-num">${v.verse}</span>${v.text}
                        </div>`
              )
              .join("");
          } catch (e) {
            el.innerHTML = `<div style="text-align:center; padding:40px; color:#888;">Offline or Error loading book.</div>`;
          }
        },
        handleVerseClick(el) {
          el.classList.toggle("active");
          // Could trigger bottom sheet actions here
        },
      };

      // --- 5. AUDIO PLAYER (Floating) ---
      const Player = {
        speaking: false,
        currentText: "",
        toggle() {
          if (this.speaking) {
            window.speechSynthesis.cancel();
            this.speaking = false;
            document.getElementById("mp-btn").innerText = "â–¶";
          } else {
            this.playText(this.currentText, "Resuming...");
          }
        },
        playChapter() {
          // Scrape text from Bible view
          const text = document
            .getElementById("bible-content")
            .innerText.replace(/\d+/g, ""); // Remove numbers
          this.playText(text, `Chapter ${Store.data.cNum}`);
        },
        playText(text, title) {
          window.speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(text);
          u.lang = "te-IN";
          u.onend = () => {
            this.speaking = false;
            document.getElementById("mp-btn").innerText = "â–¶";
          };

          window.speechSynthesis.speak(u);
          this.speaking = true;
          this.currentText = text;

          // Show Mini Player
          document.getElementById("mini-player").classList.add("visible");
          document.getElementById("mp-title").innerText = "Playing Audio";
          document.getElementById("mp-sub").innerText = title;
          document.getElementById("mp-btn").innerText = "â¸";
        },
      };

      // --- 6. SONGS MODULE ---
      const Songs = {
        render() {
          const list = document.getElementById("songs-list");
          if (list.innerHTML !== "") return; // Don't re-render if loaded
          this.filter("");
        },
        filter(q) {
          const list = document.getElementById("songs-list");
          const query = q.toLowerCase();
          list.innerHTML = SONGS.filter((s) =>
            s.t.toLowerCase().includes(query)
          )
            .map(
              (s) => `
                    <div onclick="Sheet.openLyrics('${s.t}', '${s.l}')" style="background:var(--bg-surface); padding:15px; border-radius:12px; margin-bottom:10px; display:flex; align-items:center; gap:15px; cursor:pointer;">
                        <div style="width:40px; height:40px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center;">ðŸŽµ</div>
                        <div style="font-weight:600;">${s.t}</div>
                    </div>
                `
            )
            .join("");
        },
      };

      // --- 7. BOTTOM SHEET MANAGER ---
      const Sheet = {
        open(type) {
          const content = document.getElementById("sheet-content");
          document.getElementById("sheet-overlay").classList.add("active");

          if (type === "settings") {
            content.innerHTML = `
                        <h3 style="margin-top:0;">Appearance</h3>
                        <div style="font-size:12px; font-weight:700; color:var(--text-sec); margin-bottom:10px;">THEME</div>
                        <div class="grid-3">
                            <div class="option-box ${
                              Store.data.theme === "light" ? "active" : ""
                            }" onclick="Sheet.setTheme('light')">Day</div>
                            <div class="option-box ${
                              Store.data.theme === "sepia" ? "active" : ""
                            }" onclick="Sheet.setTheme('sepia')">Sepia</div>
                            <div class="option-box ${
                              Store.data.theme === "dark" ? "active" : ""
                            }" onclick="Sheet.setTheme('dark')">Night</div>
                        </div>
                    `;
          } else if (type === "book") {
            content.innerHTML = `<h3>Select Book</h3><div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; max-height:40vh; overflow-y:auto;">
                        ${BOOKS_TE.map(
                          (b, i) =>
                            `<div class="option-box" onclick="Store.update('bIdx',${i}); Store.update('cNum',1); Sheet.close(); Bible.load();">${b}</div>`
                        ).join("")}
                    </div>`;
          }
        },
        openLyrics(title, lyrics) {
          document.getElementById("sheet-content").innerHTML = `
                    <h3 style="color:var(--primary);">${title}</h3>
                    <div style="white-space:pre-wrap; line-height:2; font-size:18px; max-height:50vh; overflow-y:auto;">${lyrics}</div>
                `;
          document.getElementById("sheet-overlay").classList.add("active");
        },
        close() {
          document.getElementById("sheet-overlay").classList.remove("active");
        },
        setTheme(t) {
          Store.update("theme", t);
          document.body.setAttribute("data-theme", t);
          this.open("settings"); // Re-render to show active state
        },
      };

      // --- INIT ---
      window.onload = () => {
        document.body.setAttribute("data-theme", Store.data.theme);
      };
    </script>
  </body>
</html>
