<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Prayer Beam</title>

    <link rel="icon" type="image/png" href="icon.png" />
    <link rel="apple-touch-icon" href="icon.png" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Crimson+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      /* --- 1. VARIABLES --- */
      :root {
        --primary: #d32f2f;
        --bg: #ffffff;
        --surface: #f4f5f7;
        --text: #111827;
        --text-sub: #6b7280;
        --border: #e5e7eb;
        --nav-height: 65px;
        --safe-area-top: env(safe-area-inset-top);
      }

      [data-theme="dark"] {
        --bg: #000000;
        --surface: #1c1c1e;
        --text: #f3f4f6;
        --text-sub: #9ca3af;
        --border: #2c2c2e;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: var(--bg);
        color: var(--text);
        padding-bottom: 90px;
      }

      /* --- 2. HOME DASHBOARD --- */
      .home-header {
        padding: 20px;
        padding-top: max(20px, var(--safe-area-top));
      }
      .date-badge {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-sub);
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .greet-title {
        font-size: 28px;
        font-weight: 800;
        margin: 5px 0 20px 0;
      }

      .vod-card {
        background: linear-gradient(
          135deg,
          #ff9a9e 0%,
          #fecfef 99%,
          #fecfef 100%
        );
        border-radius: 20px;
        padding: 25px;
        color: #333;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      .vod-text {
        font-family: "Crimson Pro", serif;
        font-size: 22px;
        font-weight: 600;
        line-height: 1.4;
        margin-bottom: 15px;
      }
      .vod-ref {
        font-weight: 700;
        font-size: 14px;
        opacity: 0.7;
      }
      .btn-share-vod {
        margin-top: 15px;
        background: rgba(255, 255, 255, 0.3);
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        backdrop-filter: blur(5px);
      }

      /* --- 3. BIBLE READER --- */
      .reader-header {
        position: sticky;
        top: 0;
        background: var(--bg);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 15px;
        z-index: 100;
      }
      .book-pill {
        background: var(--surface);
        padding: 8px 16px;
        border-radius: 30px;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
      }

      #verses-area {
        padding: 20px;
        max-width: 700px;
        margin: 0 auto;
      }
      .verse-block {
        font-family: "Crimson Pro", serif;
        font-size: 20px;
        line-height: 1.8;
        margin-bottom: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        transition: 0.2s;
        cursor: pointer;
      }
      .v-idx {
        font-family: "Inter", sans-serif;
        font-size: 11px;
        color: var(--primary);
        font-weight: 700;
        vertical-align: super;
        margin-right: 4px;
      }

      /* Highlighting Colors */
      .hl-yellow {
        background: rgba(255, 235, 59, 0.4);
      }
      .hl-green {
        background: rgba(76, 175, 80, 0.3);
      }
      .hl-pink {
        background: rgba(233, 30, 99, 0.2);
      }

      /* --- 4. SONGS (OFFLINE READY) --- */
      .song-card {
        background: var(--surface);
        padding: 16px;
        margin-bottom: 12px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer;
      }
      .song-icon {
        width: 40px;
        height: 40px;
        background: var(--primary);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      /* --- 5. IMAGE CREATOR --- */
      #creator-canvas-container {
        width: 100%;
        aspect-ratio: 1;
        background: #333;
        margin: 20px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border-radius: 12px;
      }
      #gen-canvas {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
      .color-dots {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .color-dot {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        cursor: pointer;
      }

      /* --- 6. NAVIGATION --- */
      .tab-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: var(--nav-height);
        background: var(--bg);
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
        padding-bottom: env(safe-area-inset-bottom);
      }
      .tab-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--text-sub);
        font-size: 10px;
        font-weight: 600;
        background: none;
        border: none;
        width: 60px;
      }
      .tab-btn.active {
        color: var(--primary);
      }
      .tab-icon {
        font-size: 22px;
        margin-bottom: 3px;
      }

      /* --- UTILS --- */
      .view {
        display: none;
        padding-top: var(--safe-area-top);
      }
      .view.active {
        display: block;
        animation: fadeIn 0.2s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .modal-sheet {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--bg);
        border-radius: 20px 20px 0 0;
        padding: 25px;
        box-shadow: 0 -5px 40px rgba(0, 0, 0, 0.2);
        transform: translateY(100%);
        transition: 0.3s;
        z-index: 2000;
      }
      .modal-sheet.open {
        transform: translateY(0);
      }

      /* Fullscreen Modal */
      .full-modal {
        position: fixed;
        inset: 0;
        background: var(--bg);
        z-index: 3000;
        overflow-y: auto;
        padding: 20px;
        display: none;
      }
      .full-modal.active {
        display: block;
      }
      .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--surface);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
      }

      .btn-primary {
        background: var(--text);
        color: var(--bg);
        padding: 12px;
        border-radius: 12px;
        text-align: center;
        font-weight: 600;
        margin-top: 10px;
        cursor: pointer;
      }
    </style>
  </head>
  <body data-theme="light">
    <div id="view-home" class="view active">
      <div class="home-header">
        <div class="date-badge" id="date-display">TODAY</div>
        <div class="greet-title">Prayer Beam</div>

        <div class="vod-card">
          <div class="vod-text">
            "Your word is a lamp for my feet, a light on my path."
          </div>
          <div class="vod-ref">Psalm 119:105</div>
          <button class="btn-share-vod" onclick="openCreatorWithVod()">
            üé® Create Image
          </button>
        </div>

        <div
          class="section-title"
          style="font-weight: 700; margin-bottom: 15px"
        >
          Quick Links
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">
          <div
            onclick="switchTab('songs')"
            style="
              background: var(--surface);
              padding: 20px;
              border-radius: 15px;
              text-align: center;
            "
          >
            <div style="font-size: 30px">üéµ</div>
            <div style="font-weight: 700; margin-top: 10px">Lyrics</div>
          </div>
          <div
            onclick="switchTab('tv')"
            style="
              background: var(--surface);
              padding: 20px;
              border-radius: 15px;
              text-align: center;
            "
          >
            <div style="font-size: 30px">‚ñ∂Ô∏è</div>
            <div style="font-weight: 700; margin-top: 10px">TV</div>
          </div>
        </div>
      </div>
    </div>

    <div id="view-read" class="view">
      <div class="reader-header">
        <div
          class="book-pill"
          onclick="alert('Use arrows for now. Full picker coming soon!')"
        >
          Genesis 1
        </div>
        <div style="display: flex; gap: 15px">
          <span onclick="speakChapter()" style="cursor: pointer">üîä</span>
          <span onclick="toggleTheme()" style="cursor: pointer">üåó</span>
        </div>
      </div>
      <div id="verses-area">Loading...</div>

      <div id="context-menu" class="modal-sheet">
        <h3 style="margin-top: 0">Selected Verse</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 20px">
          <div
            class="color-dot hl-yellow"
            onclick="highlight('hl-yellow')"
          ></div>
          <div class="color-dot hl-green" onclick="highlight('hl-green')"></div>
          <div class="color-dot hl-pink" onclick="highlight('hl-pink')"></div>
          <div
            class="color-dot"
            style="
              background: #ddd;
              display: flex;
              align-items: center;
              justify-content: center;
            "
            onclick="highlight('')"
          >
            ‚úï
          </div>
        </div>
        <div class="btn-primary" onclick="createImageFromSelection()">
          üé® Create Verse Image
        </div>
      </div>
    </div>

    <div id="view-songs" class="view" style="padding: 20px">
      <h2 style="margin-top: 40px">Worship Songs</h2>
      <input
        type="text"
        id="song-search"
        placeholder="Search lyrics..."
        onkeyup="renderSongs(this.value)"
        style="
          width: 100%;
          padding: 15px;
          border-radius: 12px;
          border: 1px solid var(--border);
          background: var(--surface);
          margin-bottom: 20px;
        "
      />
      <div id="song-list-container"></div>
    </div>

    <div id="view-tv" class="view" style="padding: 20px">
      <h2 style="margin-top: 40px">Prayer Beam TV</h2>

      <div id="online-content">
        <div
          style="
            background: var(--surface);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
          "
        >
          <div
            style="
              position: relative;
              padding-bottom: 56.25%;
              height: 0;
              overflow: hidden;
              border-radius: 12px;
              background: #000;
            "
          >
            <iframe
              style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
              "
              src="https://www.youtube.com/embed/videoseries?list=PLpcEZmijMVLBVJlP4oPCukvrRo-5wB-0i"
              frameborder="0"
              allowfullscreen
            ></iframe>
          </div>
          <br />
          <a
            href="https://www.youtube.com/@Prayer_Beam"
            target="_blank"
            class="btn-primary"
            style="
              display: inline-block;
              text-decoration: none;
              color: var(--bg);
            "
            >Open Channel ‚Üó</a
          >
        </div>
      </div>

      <div
        id="offline-msg"
        style="
          display: none;
          text-align: center;
          padding: 50px;
          color: var(--text-sub);
        "
      >
        <div style="font-size: 40px">üì∂</div>
        <h3>You are Offline</h3>
        <p>Please connect to the internet to watch videos.</p>
      </div>
    </div>

    <div
      id="view-create"
      class="view"
      style="padding: 20px; background: #111; color: #fff; min-height: 100vh"
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <button
          onclick="switchTab('home')"
          style="background: none; border: none; color: #fff"
        >
          ‚úï Cancel
        </button>
        <button
          onclick="downloadImage()"
          style="
            background: white;
            color: black;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
          "
        >
          Save
        </button>
      </div>
      <div id="creator-canvas-container">
        <canvas id="gen-canvas" width="1080" height="1080"></canvas>
      </div>
      <div class="color-dots">
        <div
          class="color-dot"
          style="background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%)"
          onclick="bgType=0; drawCanvas()"
        ></div>
        <div
          class="color-dot"
          style="background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%)"
          onclick="bgType=1; drawCanvas()"
        ></div>
        <div
          class="color-dot"
          style="background: #222"
          onclick="bgType=3; drawCanvas()"
        ></div>
      </div>
    </div>

    <div id="lyrics-modal" class="full-modal">
      <button
        class="close-btn"
        onclick="document.getElementById('lyrics-modal').classList.remove('active')"
      >
        ‚úï
      </button>
      <h2
        id="lyrics-title"
        style="color: var(--primary); margin-top: 60px"
      ></h2>
      <div
        id="lyrics-content"
        style="white-space: pre-wrap; line-height: 2.2; font-size: 18px"
      ></div>
    </div>

    <nav class="tab-bar">
      <button class="tab-btn active" onclick="switchTab('home')">
        <span class="tab-icon">üè†</span> Home
      </button>
      <button class="tab-btn" onclick="switchTab('read')">
        <span class="tab-icon">üìñ</span> Bible
      </button>
      <button class="tab-btn" onclick="switchTab('songs')">
        <span class="tab-icon">üéµ</span> Songs
      </button>
      <button class="tab-btn" onclick="switchTab('tv')">
        <span class="tab-icon">‚ñ∂Ô∏è</span> TV
      </button>
    </nav>

    <script>
      // --- 1. DATA & STATE ---
      let state = JSON.parse(localStorage.getItem("pb_v7")) || {
        bIdx: 0,
        cNum: 1,
        highlights: {},
        theme: "light",
      };
      const songsDB = [
        {
          t: "Yesayya Naa Pranama (2025)",
          l: "‡∞Ø‡±á‡∞∏‡∞Ø‡±ç‡∞Ø‡∞æ ‡∞®‡∞æ ‡∞™‡±ç‡∞∞‡∞æ‡∞£‡∞Æ‡∞æ - ‡∞ò‡∞®‡∞Æ‡±à‡∞® ‡∞∏‡±ç‡∞§‡±Å‡∞§‡∞ø‡∞ó‡∞æ‡∞®‡∞Æ‡∞æ\n‡∞Ö‡∞¶‡±ç‡∞≠‡±Å‡∞§‡∞Æ‡±à‡∞® ‡∞®‡±Ä ‡∞Ü‡∞¶‡∞∞‡∞£‡±á - ‡∞Ü‡∞∂‡±ç‡∞∞‡∞Ø‡∞Æ‡±à‡∞® ‡∞®‡±Ä ‡∞∏‡∞Ç‡∞∞‡∞ï‡±ç‡∞∑‡∞£‡∞Ø‡±á\n\n1. ‡∞ö‡∞ø‡∞∞‡∞ï‡∞æ‡∞≤‡∞Æ‡±Å ‡∞®‡∞æ‡∞§‡±ã ‡∞â‡∞Ç‡∞ü‡∞æ‡∞®‡∞®‡∞ø - ‡∞ï‡±ç‡∞∑‡∞£‡∞Æ‡±à‡∞®‡∞æ ‡∞µ‡±Ä‡∞°‡∞ø‡∞™‡±ã‡∞≤‡±á‡∞¶‡∞®‡∞ø...",
        },
        {
          t: "Neeve Hrudaya Saradhi",
          l: "‡∞®‡±Ä‡∞µ‡±á ‡∞π‡±É‡∞¶‡∞Ø ‡∞∏‡∞æ‡∞∞‡∞ß‡∞ø - ‡∞™‡±ç‡∞∞‡∞ó‡∞§‡∞ø‡∞ï‡∞ø ‡∞µ‡∞æ‡∞∞‡∞ß‡∞ø...",
        },
        { t: "Hosanna", l: "‡∞π‡±ã‡∞∏‡∞®‡±ç‡∞®‡∞æ.. ‡∞π‡±ã‡∞∏‡∞®‡±ç‡∞®‡∞æ..\n‡∞â‡∞®‡±ç‡∞®‡∞§‡∞Æ‡±à‡∞® ‡∞µ‡∞æ‡∞°‡∞µ‡±Å ‡∞®‡±Ä‡∞µ‡±á..." },
        { t: "Melimami Bangaru", l: "‡∞Æ‡±á‡∞≤‡∞ø‡∞Æ‡∞ø ‡∞¨‡∞Ç‡∞ó‡∞æ‡∞∞‡±Å ‡∞®‡±Ä‡∞µ‡±á ‡∞Ø‡±á‡∞∏‡∞Ø‡±ç‡∞Ø‡∞æ..." },
        { t: "Naa Hrudayam", l: "‡∞®‡∞æ ‡∞π‡±É‡∞¶‡∞Ø‡∞Ç ‡∞®‡∞ø‡∞Ç‡∞°‡±Ü‡∞®‡±Å ‡∞®‡±Ä ‡∞™‡±ç‡∞∞‡±á‡∞Æ‡∞§‡±ã..." },
      ];

      let currentVerseText = "";
      let currentVerseRef = "";
      let selectedVerseNum = null;
      let bgType = 0;

      // --- 2. INIT ---
      window.onload = () => {
        updateDate();
        loadChapter();
        renderSongs("");
        checkOnlineStatus();
      };

      function save() {
        localStorage.setItem("pb_v7", JSON.stringify(state));
      }

      // --- 3. NAV ---
      function switchTab(view) {
        document
          .querySelectorAll(".view")
          .forEach((el) => el.classList.remove("active"));
        document.getElementById("view-" + view).classList.add("active");
        document.querySelector(".tab-bar").style.display =
          view === "create" ? "none" : "flex";

        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        // simple active state logic for tabs
        if (view === "home")
          document.querySelectorAll(".tab-btn")[0].classList.add("active");
        if (view === "read")
          document.querySelectorAll(".tab-btn")[1].classList.add("active");
        if (view === "songs")
          document.querySelectorAll(".tab-btn")[2].classList.add("active");
        if (view === "tv")
          document.querySelectorAll(".tab-btn")[3].classList.add("active");

        if (view === "tv") checkOnlineStatus();
      }

      function updateDate() {
        const d = new Date();
        document.getElementById("date-display").innerText =
          d.toLocaleDateString("en-US", {
            weekday: "long",
            month: "short",
            day: "numeric",
          });
      }

      function checkOnlineStatus() {
        if (navigator.onLine) {
          document.getElementById("online-content").style.display = "block";
          document.getElementById("offline-msg").style.display = "none";
        } else {
          document.getElementById("online-content").style.display = "none";
          document.getElementById("offline-msg").style.display = "block";
        }
      }

      // --- 4. BIBLE ---
      async function loadChapter() {
        // Simple cache-first strategy for Genesis 1 (Demo)
        const container = document.getElementById("verses-area");
        container.innerHTML = "Loading...";

        try {
          const res = await fetch(
            `https://cdn.jsdelivr.net/gh/aruljohn/Bible-telugu@master/Genesis.json`
          );
          const data = await res.json();
          const verses = data.chapters[state.cNum - 1].verses;

          let html = "";
          verses.forEach((v, i) => {
            const vNum = i + 1;
            const hlClass =
              state.highlights[`${state.bIdx}-${state.cNum}-${vNum}`] || "";
            html += `<div class="verse-block ${hlClass}" onclick="openContext('${v.text}', '${vNum}')">
                        <span class="v-idx">${vNum}</span> ${v.text}
                    </div>`;
          });
          container.innerHTML = html;
        } catch (e) {
          container.innerHTML = "Offline Mode: Only cached chapters available.";
        }
      }

      function openContext(text, num) {
        currentVerseText = text;
        currentVerseRef = `Genesis 1:${num}`;
        selectedVerseNum = num;
        document.getElementById("context-menu").classList.add("open");
      }

      function highlight(color) {
        const key = `${state.bIdx}-${state.cNum}-${selectedVerseNum}`;
        if (color) state.highlights[key] = color;
        else delete state.highlights[key];
        save();
        loadChapter();
        document.getElementById("context-menu").classList.remove("open");
      }

      function speakChapter() {
        let text = document.getElementById("verses-area").innerText;
        let u = new SpeechSynthesisUtterance(text);
        u.lang = "te-IN";
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }

      // --- 5. SONGS (Offline) ---
      function renderSongs(query) {
        const list = document.getElementById("song-list-container");
        list.innerHTML = "";
        const q = query ? query.toLowerCase() : "";

        songsDB.forEach((s) => {
          if (s.t.toLowerCase().includes(q) || s.l.toLowerCase().includes(q)) {
            let div = document.createElement("div");
            div.className = "song-card";
            div.innerHTML = `<div class="song-icon">üéµ</div><div style="font-weight:600;">${s.t}</div>`;
            div.onclick = () => {
              document.getElementById("lyrics-modal").classList.add("active");
              document.getElementById("lyrics-title").innerText = s.t;
              document.getElementById("lyrics-content").innerText = s.l;
            };
            list.appendChild(div);
          }
        });
      }

      // --- 6. IMAGE CREATOR ---
      function openCreatorWithVod() {
        currentVerseText =
          "Your word is a lamp for my feet, a light on my path.";
        currentVerseRef = "Psalm 119:105";
        switchTab("create");
        drawCanvas();
      }
      function createImageFromSelection() {
        document.getElementById("context-menu").classList.remove("open");
        switchTab("create");
        drawCanvas();
      }
      function drawCanvas() {
        const canvas = document.getElementById("gen-canvas");
        const ctx = canvas.getContext("2d");
        const w = canvas.width,
          h = canvas.height;

        let grad = ctx.createLinearGradient(0, 0, w, h);
        if (bgType === 0) {
          grad.addColorStop(0, "#ff9a9e");
          grad.addColorStop(1, "#fecfef");
        } else if (bgType === 1) {
          grad.addColorStop(0, "#a1c4fd");
          grad.addColorStop(1, "#c2e9fb");
        } else {
          grad = "#222";
        }

        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, w, h);
        ctx.fillStyle = bgType === 3 ? "white" : "#333";
        ctx.font = "bold 60px 'Crimson Pro'";
        ctx.textAlign = "center";

        // Simple wrap
        const words = currentVerseText.split(" ");
        let line = "",
          y = h / 2 - 50;
        words.forEach((word) => {
          if (ctx.measureText(line + word).width > w - 200) {
            ctx.fillText(line, w / 2, y);
            line = word + " ";
            y += 80;
          } else line += word + " ";
        });
        ctx.fillText(line, w / 2, y);

        ctx.font = "40px 'Inter'";
        ctx.fillText(currentVerseRef, w / 2, y + 100);
        ctx.font = "30px 'Inter'";
        ctx.globalAlpha = 0.6;
        ctx.fillText("PRAYER BEAM", w / 2, h - 50);
        ctx.globalAlpha = 1.0;
      }
      function downloadImage() {
        const link = document.createElement("a");
        link.download = "verse.png";
        link.href = document.getElementById("gen-canvas").toDataURL();
        link.click();
      }

      // --- 7. UTILS ---
      function toggleTheme() {
        state.theme = state.theme === "light" ? "dark" : "light";
        document.body.setAttribute("data-theme", state.theme);
        save();
      }
      document.body.setAttribute("data-theme", state.theme);
    </script>
  </body>
</html>
